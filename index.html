<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MiniGPT ‚Äî Chatbot</title>
  <style>
    :root{
      --bg:#f7f7f8; --panel:#ffffff; --border:#e5e5e5; --text:#1f1f1f;
      --user-bg:#d1e7ff; --bot-bg:#ffffff; --radius:14px; --accent:#10a37f;
      font-family:"Inter",-apple-system,BlinkMacSystemFont,sans-serif;
    }
    body.dark-mode {
      --bg:#1e1e2f; --panel:#2a2a3d; --border:#3a3a55; --text:#e0e0e0;
      --user-bg:#3a3a55; --bot-bg:#2a2a3d; --accent:#10a37f;
    }
    body{margin:0; padding:0; display:flex; height:100vh; background:var(--bg); color:var(--text);}
    .sidebar{width:200px; background:var(--panel); border-right:1px solid var(--border); display:flex; flex-direction:column; padding:10px; box-sizing:border-box;}
    .chat-container{flex:1; display:flex; flex-direction:column;}
    .messages{flex:1; overflow-y:auto; padding:20px;}
    .bubble{max-width:80%; padding:12px 16px; margin-bottom:12px; border-radius:var(--radius); line-height:1.5; font-size:14px; word-wrap:break-word;}
    .bot{background:var(--bot-bg); border:1px solid var(--border); align-self:flex-start;}
    .user{background:var(--user-bg); align-self:flex-end;}
    .composer{border-top:1px solid var(--border); padding:10px; display:flex; gap:10px; background:var(--panel);}
    textarea{flex:1; padding:10px; border-radius:var(--radius); border:1px solid var(--border); resize:none;}
    button{background:var(--accent); color:white; border:none; padding:6px 12px; border-radius:var(--radius); cursor:pointer;}
    select{padding:6px 10px; border-radius:var(--radius); border:1px solid var(--border);}
    .chat-btn{background:none; border:none; text-align:left; padding:8px; cursor:pointer; border-radius:var(--radius);}
    .chat-btn.active{background:var(--accent); color:white;}
    .sidebar-header{display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;}
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="sidebar-header">
      <div>Chats</div>
      <button id="newChatBtn">+</button>
    </div>
    <div id="chatList"></div>
  </div>

  <div class="chat-container">
    <div style="padding:10px; display:flex; justify-content:space-between; align-items:center; background:var(--panel); border-bottom:1px solid var(--border);">
      <div>
        Model:
        <select id="modelSelect">
          <option value="gpt-4.1-mini">gpt-4.1-mini</option>
          <option value="gpt-4o-mini">gpt-4o-mini</option>
          <option value="gpt-3.5-turbo">gpt-3.5-turbo</option>
        </select>
      </div>
      <button id="themeToggle">üåô</button>
    </div>

    <div class="messages" id="messages"></div>

    <div class="composer">
      <textarea id="input" placeholder="Message MiniGPT..."></textarea>
      <button id="sendBtn">Send</button>
    </div>
  </div>

<script>
const messagesEl = document.getElementById('messages');
const inputEl = document.getElementById('input');
const sendBtn = document.getElementById('sendBtn');
const modelSelect = document.getElementById('modelSelect');
const themeToggle = document.getElementById('themeToggle');
const newChatBtn = document.getElementById('newChatBtn');
const chatListEl = document.getElementById('chatList');

let chats = JSON.parse(localStorage.getItem('miniGPTChats')||'[]');
let currentChatId = null;

// Add bubble
function addBubble(text, cls){
  const div = document.createElement('div');
  div.className = `bubble ${cls}`;
  div.textContent = text;
  messagesEl.appendChild(div);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}

// Save all chats
function saveChats() {
  localStorage.setItem('miniGPTChats', JSON.stringify(chats));
}

// Render chat list
function renderChatList() {
  chatListEl.innerHTML = '';
  chats.forEach(chat => {
    const btn = document.createElement('button');
    btn.className = 'chat-btn' + (chat.id === currentChatId ? ' active':'');
    btn.textContent = chat.title;
    btn.onclick = () => loadChat(chat.id);
    chatListEl.appendChild(btn);
  });
}

// Load chat
function loadChat(id){
  const chat = chats.find(c=>c.id===id);
  if(!chat) return;
  currentChatId = id;
  messagesEl.innerHTML = '';
  chat.history.forEach(msg => addBubble(msg.content, msg.role==='user'?'user':'bot'));
  renderChatList();
}

// Create new chat
function createNewChat() {
  const newChat = {
    id: Date.now(),
    title: `Chat ${chats.length+1}`,
    history: []
  };
  chats.push(newChat);
  currentChatId = newChat.id;
  messagesEl.innerHTML = '';
  addBubble("Hello! I'm MiniGPT ‚Äî ask me anything!", 'bot');
  saveChats();
  renderChatList();
}

// Send message
async function sendMessage(){
  const text = inputEl.value.trim();
  if(!text || currentChatId===null) return;

  const chat = chats.find(c=>c.id===currentChatId);
  addBubble(text, 'user');
  inputEl.value='';
  addBubble('‚Ä¶','bot');
  const loadingBubble = messagesEl.lastChild;

  chat.history.push({role:'user', content:text});
  saveChats();

  try{
    const res = await fetch('https://mini-gpt-backend.vercel.app/api/chat',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ message:text, model:modelSelect.value, history:chat.history })
    });
    const data = await res.json();
    loadingBubble.textContent = data.reply || 'No reply';
    chat.history.push({role:'assistant', content:data.reply||''});
    saveChats();
  } catch(e){
    loadingBubble.textContent = 'Error: '+e.message;
  }
}

// Event listeners
sendBtn.onclick = sendMessage;
inputEl.addEventListener('keydown', e=>{
  if(e.key==='Enter' && !e.shiftKey){
    e.preventDefault();
    sendMessage();
  }
});
newChatBtn.onclick = createNewChat;
themeToggle.onclick = () => {
  document.body.classList.toggle('dark-mode');
  themeToggle.textContent = document.body.classList.contains('dark-mode')?'‚òÄÔ∏è':'üåô';
}

// Init
if(chats.length===0) createNewChat();
else loadChat(chats[chats.length-1].id);
</script>
</body>
</html>
